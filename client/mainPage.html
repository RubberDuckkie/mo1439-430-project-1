<!DOCTYPE html>
<html>

<head>
  <title>Genshin Constructor</title>
  <link href="default-styles.css" type="text/css" rel="stylesheet" />
  <style>
    body {
      background-color: #818589;
      font-family: 'Lucida Sans', 'Lucida Sans Regular', 'Lucida Grande', 'Lucida Sans Unicode', Geneva, Verdana, sans-serif;
    }
  </style>
  <script>

    const handleResponse = (e) => {
      console.log("e.target =", e.target);
      console.log("e.target.response =", e.target.response);
      const obj = JSON.parse(e.target.response);
      console.log("obj=", obj);
      //now go ahead and update #jokeContainer with the contents of the joke
      charContainer.innerHTML = `
      <p>Character: <b>${obj.name}</b></p>
      <p>Weapon: <b>${obj.weapon}</b></p>
      <p>Vision: <b>${obj.vision}</b></p>
      `;
      if (obj.vision === 'Anemo'){
        document.body.style.backgroundColor = '#6CF7E4'
      } else if (obj.vision === 'Pyro'){
        document.body.style.backgroundColor = '#F62424'
      } else if (obj.vision === 'Geo'){
        document.body.style.backgroundColor = '#F6BB24'
      } else if (obj.vision === 'Cryo'){
        document.body.style.backgroundColor = '#64F6D9'
      } else if (obj.vision === 'Electro'){
        document.body.style.backgroundColor = '#6847DE'
      } else if (obj.vision === 'Hydro'){
        document.body.style.backgroundColor = '#00D6F0'
      }

    }


    const downloadCharacter = (e) => {
      // remember that an `Event` object gets passed along every time that an event handler or listener calls a function
      // the `target` property of that event points at the element that sent the event, in this case a button
      console.log(`An element of id=${e.target.id} was clicked!`);
    
      const characterURL = "/character";
      const xhr = new XMLHttpRequest();
      xhr.onload = handleResponse;
      xhr.open("GET", characterURL);
      //with XHR, after we open a connection, but before we `send()`, we can set 1 or more HTTP request headers
      //this isn't strictly necessary because "/random-joke" sends JSON be default
      xhr.setRequestHeader('Accept', "application/javascript");
      xhr.send();

    }



    const init = () => {
      // An Event *Handler*
      document.querySelector("#rndChara").addEventListener("click", downloadCharacter);
      // An Event *Listener*



      document.querySelector("#character-form").onsubmit = e => {
        console.log('Character Has Been Added!!!')
        e.preventDefault();
        const form = e.target;
        const action = form.action;
        const method = form.method;
        const name = form["name"].value;
        const weapon = form["weapon"].value;
        const vision = form["vision"].value;
        const formData = `name=${name}&weapon=${weapon}&vision=${vision}`;

        const xhr = new XMLHttpRequest();
        xhr.onload = e => {
          charContainer.innerHTML = JSON.parse(e.target.responseText).message;
        };
        xhr.open(method,action);
        xhr.setRequestHeader('Content-Type', 'application/x-www-form-urlencoded');
        xhr.send(formData);

        return false;
      };



      // **Actually, event handlers and listeners are NOT exactly the same in all use cases - what ARE the differences?**
    }

    window.onload = init;

  </script>
</head>
<bloc>

  <body>
    <header>
      <h1>Genshin Character Index</h1>
    </header>

    <section>
      <h2>Want to see a character??</h2>
      <h5>If your vision isnt a real one, the color wont change.<br>
      The real elements are Anemo, Geo, Pyro, Hydro, Electro and Cryo</h5>
      <p><button id="rndChara">Random Character!!!</button></p>
      <div id="charContainer"> </div>
    </section>

    <section>
      <h2>Select a Character to add to the Index</h2>
      <form id="character-form" method="POST" action="/build-character">
        <label for="name">Name:</label>
        <input type="text" id="name" name="name"><br><br>
        <label for="weapon">Weapon:</label>
        <input type="text" id="weapon" name="weapon"><br><br>
        <label for="vision">Vision:</label>
        <input type="text" id="vision" name="vision"><br><br>
        <input type="submit" value="Submit" />
    </section>


  </body>

</html>